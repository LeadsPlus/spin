#!/usr/bin/env ruby

require 'spin/watcher'
require 'spin/preloader'
require 'spin/socket'

# requires
# parse options (preload an extra path(s), add path(s) to watch)

trap("SIGINT") { exit }

# signal handlers
#
# spawn file watcher w/ pipe
reader = Spin::Watcher.spawn

at_exit { File.delete(Spin::Socket.filepath) }
push_socket = Spin::Socket.open

# preload rails
Spin::Preloader.require_files

# IO.select pipe + unix socket
  # add files to be processed to the next test run obj
    # include the recved io if applicable
  # if no test runs are in progress then spin one up (use a pipe to signal the master when it's finished), otherwise just wait

